<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buy the all Variant of Cakes Online - House of Cake - Colombo, Sri Lanka</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/x-icon" sizes="32x32" href="img/favicon_io/favicon-32x32.png">

</head>
<body>
    
    <section id="header">
        <a href="#"><img src="img/web_logo_new.png" /> <alt= ""></alt></a>
        <div>
            <ul id="navbar">
                <li> <a  href="index.html"> Home</a></li>
                <li> <a href="shop.html"> Shop</a></li>
                <li> <a href="blog.html"> Blog</a></li>
                <li> <a href="about.html"> About</a></li>
                <li> <a href="contact.html"> Contact</a></li>
                <li id="lg-bag"> <a class="active" href="cart.html"><i class="fas fas fa-shopping-bag"></i></a></li>
                <a href="#" id="close"> <i class="fa-solid fas fa-xmark"></i></a>
            </ul>
        </div>

        <div id="mobile">
            <a href="cart.html"><i class="fas fa-shopping-bag"></i></a>
            <i id="bar" class="fa-solid fas fa-bars"></i>
        </div>



    </section>

    <div class="snow_wrap">
        <div class="snow"></div>

<section id="cart-header">
    <h2>#Shopping for Soul</h2>
    <p>Shop whenever in doubt...</p>



</section>
</div>


<section id="cart" class="section-p1">
    <table width="100%">
        <thead>
            <td>Remove</td>
            <td>Image</td>
            <td>Product</td>
            <td>Price</td>
            <td>Quantity</td>
            <td>Subtotal</td>
        </tr>
        </thead>
        <tbody id="shoppingcartitems">
            <tr>
                <td><a href="#"> <i class="far fa-times-circle"></i></a> </td>
                <td><img src="img/products/1.png" alt=""></td>
                <td>Black Forest Marquies Cake</td>
                <td>LKR 3500.00</td>
                <td><input type="number" value="1"></td>
                <td>LKR 3500.00</td>
            </tr>
            <tr>
                <td><a href="#"> <i class="far fa-times-circle"></i></a> </td>
                <td><img src="img/products/2.png" alt=""></td>
                <td>Exotic Fruit Vanilla Sponge Cake</td>
                <td>LKR 3900.00</td>
                <td><input type="number" value="2"></td>
                <td>LKR 7800.00</td>
            </tr>
            <tr>
                <td><a href="#"> <i class="far fa-times-circle"></i></a> </td>
                <td><img src="img/products/3.png" alt=""></td>
                <td>Blueberry Cheesecake</td>
                <td>LKR 4000.00</td>
                <td><input type="number" value="1"></td>
                <td>LKR 4000.00</td>
            </tr>
        </tbody>
    </table>
</section>


<section id="cart-add" class="section-p1">
    <div id="coupon">
        <h3>Apply Coupon</h3>
        <div>
            <input type="text" placeholder="Enter Your Coupon">
            <button class="normal">Apply</button>

        </div>
    </div>
    <div id="subtotal">
        <h3>Cart Totals</h3>
        <table>
            <tr>
            <td>Cart Subtotal</td>
            <td>LKR <span id="cartsubtotal"></span>.00</td>
        </tr>
        <tr>
            <td>Shipping</td>
            <td>Free</td>
        </tr>
        <tr>
            <td><strong>Total</strong></td>
            <td><strong>LKR <span id="carttotal"></span>.00</strong></td>
        </tr>
        </table>
        <button class="normal"> Proceed to Checkout</button>
    </div>
</section>





<footer class="section-p1">
    <div class="col">
        <img class="logo" src="img/web_logo_new.png" alt="">
        <h4>Contact</h4>
        <p><strong>Address :</strong> 70/c Hill Street, Colombo 07</p>
        <p><strong>Phone :</strong> +9411 256 7897</p>
        <p><strong>Hours :</strong> 10:00 - 18:00,  Mon - Sat</p>
        <div class="follow">
            <h4>Follow Us</h4>
            <div class="icon">
                <i class="fab fa-facebook-f"></i>
                <i class="fab fa-twitter"></i>
                <i class="fab fa-instagram"></i>
                <i class="fab fa-pinterest-p"></i>
                <i class="fab  fa-youtube"></i>
            </div>
        </div>
    </div>

    <div class="col">
        <h4>About</h4>
        <a href="#">About Us</a>
        <a href="#">Delivery Information</a>
        <a href="#">Privacy Policy</a>
        <a href="#">Tearm & Conditions</a>
        <a href="#">Contact Us</a>
    </div>

    <div class="col">
        <h4>My Account</h4>
        <a href="#">Sign In</a>
        <a href="#">View Cart</a>
        <a href="#">My WishList</a>
        <a href="#">Track My Order</a>
        <a href="#">Help</a>
    </div>

    <div class="install">
        <h4>Install App</h4>
        <p>From App Store or Google Play Store</p>
        <div class="row">
            <img src="img/products/pay/as_s.jpg" alt="">
            <img src="img/products/pay/ps_s.jpg" alt="">
        </div>
        <p>Secured Payment Gateways</p>
        <img src="img/products/pay/pay-cards-new.png" alt="">
    </div>

    <div class="copyright">
        <p>Â© 2022 House of Cake. All rights reserved.</p>
    </div>

</footer>

    

<script>
    var urlString = window.location.href;
    var url = new URL(urlString);
    
    function saveToShoppingCart() {
        var urlString = window.location.href;
        var url = new URL(urlString);
        var detailsObj = {
            index: url.searchParams.get("index"),
            imageUrl: url.searchParams.get("imgurl"),
            name: url.searchParams.get("name"),
            price: parseInt(url.searchParams.get("price")),
            quantity: parseInt(url.searchParams.get("quantity"))
        };
        var shoppingCart = JSON.parse(localStorage.getItem("cakeShopShoppingCart"));
        if(detailsObj.name) {
            if(shoppingCart) {
                if(shoppingCart.items) {
                    if (shoppingCart.items.findIndex(function(item) {return item.index == detailsObj.index}) >= 0) {
                        shoppingCart.items[shoppingCart.items.findIndex(function(item) {return item.index == detailsObj.index})].quantity += 1;
                    } else {
                        shoppingCart.items = [...shoppingCart.items, detailsObj];
                    }
                } else {
                    shoppingCart.items = [detailsObj];
                }
            } else {
                shoppingCart = {
                    items: [detailsObj]
                };
            }
        }
        localStorage.setItem("cakeShopShoppingCart", JSON.stringify(shoppingCart));
    }
    //document.getElementById('addtocart').addEventListener("click", saveToShoppingCart);
    saveToShoppingCart();
    console.log("cart.html");

    function loadShoppingCart() {
        var shoppingCart = JSON.parse(localStorage.getItem("cakeShopShoppingCart"));
        var shoppingCartTableRows = "";
        if(shoppingCart) {
            if(shoppingCart.items) {
                shoppingCartTableRows = shoppingCart.items.map(function(item) {
                    return `
                    <tr>
                        <td><a href="#" data-id="${item.index}" class="cartitemremove"> <i class="far fa-times-circle"></i></a> </td>
                        <td><img src="img/products/${item.imageUrl}.png" alt=""></td>
                        <td>${item.name}</td>
                        <td>LKR ${item.price}.00</td>
                        <td><input data-id="${item.index}" class="quantityinput" type="number" value="${item.quantity}"></td>
                        <td>LKR ${item.price * item.quantity}.00</td>
                    </tr>
                    `;
                }).join("");
            }
        }
        console.log(shoppingCartTableRows);
        document.getElementById("shoppingcartitems").innerHTML = shoppingCartTableRows;
    }
    loadShoppingCart();

    function updateSubtotal() {
        var shoppingCart = JSON.parse(localStorage.getItem("cakeShopShoppingCart"));
        var shoppingCartSubTotal = 0;
        if(shoppingCart) {
            if(shoppingCart.items.length > 0) {
                shoppingCartSubTotal = shoppingCart.items.map(function(item) {return item.price * item.quantity}).reduce(function(total, item) {
                    return total + item;
                });
            }
        }
        console.log(shoppingCartSubTotal);
        document.getElementById("cartsubtotal").innerHTML = shoppingCartSubTotal;
        document.getElementById("carttotal").innerHTML = shoppingCartSubTotal;
    }
    updateSubtotal();

    function changeQuantity(input, index) {
        var shoppingCart = JSON.parse(localStorage.getItem("cakeShopShoppingCart"));
        //console.log(index);
        shoppingCart.items[shoppingCart.items.findIndex(function(item) {return item.index == parseInt(index)})].quantity = parseInt(input.value);
        //console.log(parseInt(input.value));

        localStorage.setItem("cakeShopShoppingCart", JSON.stringify(shoppingCart));
        console.log(shoppingCart)

        loadShoppingCart();
        updateSubtotal();

        Object.values(document.getElementsByClassName('quantityinput')).forEach(input => {
            input.addEventListener("change", () => changeQuantity(input, input.getAttribute("data-id")));
        });
        Object.values(document.getElementsByClassName('cartitemremove')).forEach(item => {
            item.addEventListener("click", () => removeItem(item, item.getAttribute("data-id")));
        });
    }
    Object.values(document.getElementsByClassName('quantityinput')).forEach(input => {
        input.addEventListener("change", () => changeQuantity(input, input.getAttribute("data-id")));
    });

    function removeItem(item, index) {
        var shoppingCart = JSON.parse(localStorage.getItem("cakeShopShoppingCart"));
        //console.log(index);
        //shoppingCart.items[shoppingCart.items.findIndex(function(item) {return item.index == parseInt(index)})].quantity = parseInt(input.value);
        shoppingCart.items.splice(shoppingCart.items.findIndex(function(item) {return item.index == parseInt(index)}), 1);
        //console.log(parseInt(input.value));

        localStorage.setItem("cakeShopShoppingCart", JSON.stringify(shoppingCart));
        console.log(shoppingCart);

        loadShoppingCart();
        updateSubtotal();

        Object.values(document.getElementsByClassName('quantityinput')).forEach(input => {
            input.addEventListener("change", () => changeQuantity(input, input.getAttribute("data-id")));
        });
        Object.values(document.getElementsByClassName('cartitemremove')).forEach(item => {
            item.addEventListener("click", () => removeItem(item, item.getAttribute("data-id")));
        });
    }
    Object.values(document.getElementsByClassName('cartitemremove')).forEach(item => {
        item.addEventListener("click", () => removeItem(item, item.getAttribute("data-id")));
    });

    //window.history.replaceState({}, document.title, "/");
    if(url.searchParams.get("name")) {
        window.location.href = 'cart.html';
    }
</script>
<script src="script.js"></script>
</body>
</html>